@using siges.Models
@using System
@using System.Globalization
@{
ViewData["Title"] = "Editar Órden de servicio";
bool paquete = Boolean.Parse(((bool)ViewData["siPaquete"]).ToString());
bool esCancelable = Boolean.Parse(((bool)ViewData["esCancelable"]).ToString());
}

@section css {
<link href="~/lib/Parsley-2.8.1/parsley.css" rel="stylesheet" />
<link href="~/lib/tempusdominus-5.0.0/build/css/tempusdominus-bootstrap-4.css" rel="stylesheet" />
<link rel="stylesheet" href="~/lib/bootstrap-select/dist/css/bootstrap-select.min.css">
}

@{
var eOS = ((OrdenServicio)ViewData["orden"]);
var osafTotal = 0;
var osTotal = 0;
var osiTotal = 0;
}

@section modals{
<div class="modal fade" id="capturaComentario" tabindex="-1" role="dialog" aria-labelledby="capturaComentarioTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="capturaComentarioTitle">Cambio de estatus</h5>
        <button id="cancelaCapturaDatos1" type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="jumbotron jumbotron-fluid">
          <div class="container">
            <form id="capturaComentarioForm" action="@Url.Action( "CapturaComentario", "Servicio")" method="post">
              <div class="form-group">
                <label for="MotivoCambio">Motivo cambio de estatus</label>
                <input type="text" class="form-control" id="MotivoCambio" aria-describedby="motivoCambio" placeholder="Cambio de estatus" required name="MotivoCambio">
                <small id="motivoCambio" class="form-text text-muted">Descripción por el cual es necesario cambiar el estatus de la Orden de Servicio</small>
              </div>
              <input type="hidden" value="@eOS.Id" name="OrdenServicioId">
              <input id="iDeCambiaEstatus" type="hidden" name="De">
              <input id="iACambiaEstatus" type="hidden" name="A">
              <button id="cambiarEstatus" type="submit" class="btn btn-success">Cambiar estatus</button>
            </form>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancelaCapturaDatos2" type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="asignacionInsumos" tabindex="-1" role="dialog" aria-labelledby="asignacionInsumosTitle" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="asignacionInsumosTitle">Captura datos del Insumo</h5>
        @*<button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>*@
      </div>
      <div class="modal-body">

        <div class="container-fluid">
          <div class="row">
            <div class="col">
              <h5 class="card-title" id="car-title-Insumos">Nombre del insumo que va a ingresar a la lista de asignación.</h5>
              <div class="form-group">
                <label for="osLoteI">Lote</label>
                <input id="osLoteI" type="text" class="form-control">
              </div>
              @*<div class="form-group">
                <label for="osCaducidadI">Caducidad</label>
                <div id="osCaducidadI" class="input-group date" data-target-input="nearest">
                  <input type="text" class="form-control datetimepicker-input" data-target="#osCaducidadI" placeholder="dd/MM/aaaa">
                  <div class="input-group-append" data-target="#osCaducidadI" data-toggle="datetimepicker">
                    <div class="input-group-text"><i data-feather="calendar"></i></div>
                  </div>
                </div>
              </div>*@
              <div class="form-group">
                <label for="osCantidadI">Cantidad</label>
                <input id="osCantidadI" type="number" min="1" class="form-control">
              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" id="ignoreInsumo" class="btn btn-danger" data-dismiss="modal">Quitar</button>
        <button type="button" id="addInsumoToTable" class="btn btn-primary">Agregar insumo</button>
      </div>
    </div>
  </div>
</div>
}


<div class="container" style="margin-bottom: 100px;">
  <div class="row">
      <div class="col">
        <h2>Editar &Oacute;rden de Servicio</h2>
      </div>
      <div class="col align-self-center text-right">
        <a class="btn bg-blue marg-Float float" href='@Url.Action("IndexListOS", "Servicio")'  data-toggle="tooltip" data-placement="bottom" title="Regresar" data-original-title="Tooltip on bottom"><i class="fas fa-arrow-left"></i></a>
      </div>
  </div>
  <div class="row margTop40">
    <div class="col">
      <div id="tab-lists" class="row">
  <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
    <div class="list-group" role="tablist">
      <a id="stepOne" class="list-group-item list-group-item-action flex-column align-items-start active" href="#infoGral" role="tab">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">1) Informaci&oacute;n general</h5>
        </div>
        <small>Informaci&oacute;n general de la orden.</small>
      </a>
    </div>
  </div>
  <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
    <div class="list-group" role="tablist">
      <a id="stepTwo" class="list-group-item list-group-item-action" href="#infoResponsable" role="tab">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">2) Informaci&oacute;n del responsable</h5>
        </div>
        <small>Informaci&oacute;n sobre el responsable que recibe el servicio.</small>
      </a>
    </div>
  </div>
  <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
    <div class="list-group" role="tablist">
      <a id="stepThree" class="list-group-item list-group-item-action" href="#infoPersonal" role="tab">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">3) Asignaci&oacute;n del personal</h5>
        </div>
        <small>Detalle del personal que brinda el servicio.</small>
      </a>
    </div>
  </div>
  <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
    <div class="list-group" role="tablist">
      <a id="stepFour" class="list-group-item list-group-item-action" href="#infoActivosFijos" role="tab">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">4) Asignaci&oacute;n de activos fijos/productos</h5>
        </div>
        <small>Detalle de los activos fijos/productos asignados.</small>
      </a>
    </div>
  </div>
  <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
    <div class="list-group" role="tablist">
      @if(paquete.ToString() != "True"){
      <a id="stepFive" class="list-group-item list-group-item-action" href="#infoInsumos" role="tab">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">5) Asignaci&oacute;n de insumos utilizados</h5>
        </div>
        <small>Detalle del los insumos utilizados en un servicio.</small>
      </a>
      } else {
      <a id="stepFive" class="list-group-item list-group-item-action" href="#infoInsumosP" role="tab">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">5) Asignaci&oacute;n de insumos utilizados</h5>
        </div>
        <small>Detalle del los insumos utilizados en un servicio.</small>
      </a>
      }
    </div>
  </div>
</div>
<div class="py-2">
  <div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="25" aria-valuemin="25" aria-valuemax="100" style="width: 25%;"></div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-12">
    <form id="fEditOS" action="@Url.Action( "EditOS", "Servicio")" method="post">
      <div class="card">
        <div class="card-body">
          <div class="tab-content">
            <div id="infoGral" class="tab-pane fade show active form-section" role="tabpanel">
              <div class="form-group">
                <label for="iFolio">Folio</label>
                <input id="iFolio" type="text" class="form-control" name="Folio" value="@eOS.Folio" required="" readonly>
              </div>

              <div class="form-group">
                <label for="iCliente">Cliente</label>
                @if(eOS.LineaNegocio.Nombre.Equals("GARANTÍA")){
                <input class="form-control" type="text" value="@eOS.Cliente.RazonSocial" readonly>
                <input id="iCliente" type="hidden" name="Cliente" value="@eOS.Cliente.Id" required="">
                } else {
                <select id="iCliente" class="form-control" name="Cliente" required="">
                  @foreach (var cliente in ViewData["clientes"] as List<Cliente>)
                  {
                  @if (cliente.Id == eOS.Cliente.Id)
                  {
                  <option selected value="@cliente.Id">@cliente.RazonSocial</option>
                  }
                  else
                  {
                  <option value="@cliente.Id">@cliente.RazonSocial</option>
                  }
                  }
                </select>
                }
              </div>

              <div class="form-group">
                <label for="iContrato">Contrato</label>
                <select id="iContrato" class="form-control" name="Contrato" required="">
                  <option value=""> -- Selecciona una opci&oacute;n -- </option>
                  @foreach (var contrato in ViewData["contratos"] as List<Contrato>)
                  {
                  @if (@contrato.Id == eOS.Contrato.Id)
                  {
                  <option selected value="@contrato.Id">@contrato.Nombre</option>
                  }
                  else
                  {
                  <option value="@contrato.Id">@contrato.Nombre</option>
                  }
                  }
                </select>
              </div>

              <div class="form-group">
                <label for="iUbicacion">Ubicaci&oacute;n</label>
                <select id="iUbicacion" class="form-control" name="Ubicacion" required="">
                  <option value=""> -- Selecciona una opci&oacute;n -- </option>
                  @foreach (var ubicacion in ViewData["ubicaciones"] as List<Ubicacion>)
                  {
                  @if (@ubicacion.Id == eOS.Ubicacion.Id)
                  {
                  <option selected value="@ubicacion.Id">@ubicacion.Nombre</option>
                  }
                  else
                  {
                  <option value="@ubicacion.Id">@ubicacion.Nombre</option>
                  }
                  }
                </select>
              </div>

              <div class="form-group">
                <label for="iLineaNegocio">L&iacute;nea de negocio</label>
                @if(eOS.LineaNegocio.Nombre.Equals("GARANTÍA")){
                <input id="iLineaNegocio" type="hidden" name="LineaNegocio" required="" value="@eOS.LineaNegocio.Id">
                <input id="garantia" class="form-control" type="text" value="@eOS.LineaNegocio.Nombre" readonly>
                } else {
                <select id="iLineaNegocio" class="form-control" name="LineaNegocio" required="">
                  <option value=""> -- Selecciona una opci&oacute;n -- </option>
                  @foreach (var linea in ViewData["lineas"] as List<LineaNegocio>)
                  {
                  @if (@linea.Id == eOS.LineaNegocio.Id)
                  {
                  <option selected value="@linea.Id">@linea.Nombre</option>
                  }
                  else
                  {
                  <option value="@linea.Id">@linea.Nombre</option>
                  }
                  }
                </select>
                }
              </div>

              <div class="form-group">
                <label for="iServicio">Servicio</label>
                <select id="iServicio" class="form-control" name="Servicio" required="">
                  <option value=""> -- Selecciona una opci&oacute;n -- </option>
                  @foreach (var servicio in ViewData["servicios"] as List<Servicio>)
                  {
                  @if (servicio.Id == eOS.Servicio.Id)
                  {
                  <option selected value="@servicio.Id">@servicio.Nombre</option>
                  }
                  else
                  {
                  <option value="@servicio.Id">@servicio.Nombre</option>
                  }
                  }
                </select>
              </div>

              <div class="form-group">
                <label for="iEstatus">Estatus</label>
                <select id="iEstatus" class="form-control" name="EstatusServicio" required="">
                  @if (eOS.EstatusServicio != null)
                  {
                  @if (eOS.EstatusServicio.Equals("solicitado"))
                  {
                  <option selected value="solicitado">Solicitado</option>
                  <option value="programado">Programado</option>
                  if(esCancelable){
                    <option value="cancelado">Cancelado</option>
                  }
                  }
                  else if (eOS.EstatusServicio.Equals("programado"))
                  {
                  <option selected value="programado">Programado</option>
                  <option value="reprogramado">Reprogramado</option>
                  if(esCancelable){
                    <option value="cancelado">Cancelado</option>
                  }
                  <option value="finalizado">Finalizado</option>
                  }
                  else if (eOS.EstatusServicio.Equals("reprogramado"))
                  {
                  <option selected value="reprogramado">Reprogramado</option>
                  <option value="cancelado">Cancelado</option>
                  <option value="finalizado">Finalizado</option>
                  }
                  else if (eOS.EstatusServicio.Equals("cancelado"))
                  {
                  <option value="reprogramado">Reprogramado</option>
                  <option selected value="cancelado">Cancelado</option>
                  }
                  else if (eOS.EstatusServicio.Equals("finalizado"))
                  {
                  <option selected value="finalizado">Finalizado</option>
                  }
                  else if (eOS.EstatusServicio.Equals("facturado"))
                  {
                  <option selected value="facturado">Facturado</option>
                  }
                  else if (eOS.EstatusServicio.Equals("cobrado"))
                  {
                  <option selected value="cobrado">Cobrado</option>
                  }
                  else if (eOS.EstatusServicio.Equals("nocobrado"))
                  {
                  <option selected value="nocobrado">No Cobrado</option>
                  }
                  else
                  {
                  <option selected>Indefinido</option>
                  <option value="solicitado">Solicitado</option>
                  <option value="programado">Programado</option>
                  <option value="reprogramado">Reprogramado</option>
                  <option value="cancelado">Cancelado</option>
                  <option value="finalizado">Finalizado</option>
                  }
                  }
                  else
                  {
                  <option selected>Indefinido</option>
                  <option value="solicitado">Solicitado</option>
                  <option value="programado">Programado</option>
                  <option value="reprogramado">Reprogramado</option>
                  <option value="cancelado">Cancelado</option>
                  <option value="finalizado">Finalizado</option>
                  }
                </select>
              </div>

              <div class="form-group">
                <label for="iTipo">Tipo</label>
                <select id="iTipo" class="form-control" name="Tipo" required="">
                  <option value=""> -- Selecciona una opci&oacute;n -- </option>
                  @if (eOS.Tipo.Equals("Ordinario"))
                  {
                  <option selected value="Ordinario">Ordinario</option>
                  <option value="Extraordinario">Extraordinario</option>
                  }
                  else
                  {
                  <option value="Ordinario">Ordinario</option>
                  <option selected value="Extraordinario">Extraordinario</option>
                  }
                </select>
              </div>

              <div class="form-group">
                <label for="iObs">Observaciones</label>
                <textarea class="form-control" id="iObs" rows="3" name="Observaciones">@eOS.Observaciones</textarea>
              </div>

              <div class="row">
              <div class="form-group">
                <label for="iFechaInicio">Fecha/Hora de inicio</label>
                <div class="input-group date" id="iFechaInicio" data-target-input="nearest">
                  <input type="text" class="form-control datetimepicker-input" data-target="#iFechaInicio" name="FechaInicio" value="@(eOS.FechaInicio.HasValue ? ((DateTime) eOS.FechaInicio).ToString("g", CultureInfo.CreateSpecificCulture("es-ES")) : null)" placeholder="dd/mm/aaaa 00:00" required=""/>
                  <div class="input-group-append" data-target="#iFechaInicio" data-toggle="datetimepicker">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                  </div>
                </div>
                <div id="eiFechaInicio"></div>
              </div>

              <div class="form-group">
                <label for="iFechaFin">Fecha/Hora de fin</label>
                <div class="input-group date" id="iFechaFin" data-target-input="nearest">
                  <input type="text" class="form-control datetimepicker-input" data-target="#iFechaFin" name="FechaFin" value="@(eOS.FechaFin.HasValue ? ((DateTime) eOS.FechaFin).ToString("g", CultureInfo.CreateSpecificCulture("es-ES")) : null)" placeholder="dd/mm/aaaa 00:00" required=""/>
                  <div class="input-group-append" data-target="#iFechaFin" data-toggle="datetimepicker">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                  </div>
                </div>
                <div id="eiFechaFin"></div>
              </div>
              </div>

            </div>

            <div id="infoResponsable" class="tab-pane fade show form-section" role="tabpanel">
              <div class="form-row">
                <div class="form-group col-6">
                  <label class="control-label" for="slcContacto">Contacto</label>
                  <select class="form-control" id="slcContacto" >
                    <option value="null" selected disabled>Selecciona un Contacto</option>
                  </select>
                </div>
                <div class="form-group col-6">
                  <label for="iNombre">Nombre</label>
                  <input id="iNombre" type="text" class="form-control" name="ContactoNombre" value="@eOS.ContactoNombre" required  readonly maxlength="30" /> 
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-6">
                  <label for="iAp">Apellido paterno</label>
                  <input id="iAp" type="text" class="form-control" name="ContactoAP" value="@eOS.ContactoAP" required readonly maxlength="30" />
                </div>
                <div class="form-group col-6">
                  <label for="iAm">Apellido materno</label>
                  <input id="iAm" type="text" class="form-control" name="ContactoAM" value="@eOS.ContactoAM" required readonly maxlength="30" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-6">
                  <label for="iEm">Correo electrónico</label>
                  <input id="iEm" type="text" class="form-control" name="ContactoEmail" value="@eOS.ContactoEmail" required readonly />
                </div>
                <div class="form-group col-6">
                  <label for="iTel">Tel&eacute;fono de contacto</label>
                  <input id="iTel" type="text" class="form-control" maxlength="10" name="ContactoTelefono" value="@eOS.ContactoTelefono" required="" readonly />
                </div>
              </div>

              @if (!(String.IsNullOrEmpty(eOS.NombreCompletoCC1)  && String.IsNullOrEmpty(eOS.EmailCC1))){
              @eOS.EmailCC1
              @eOS.EmailCC2
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="ccCheck1" checked>
                <label class="form-check-label m-1" for="ccCheck1">
                  ¿Enviar copia de la notificación al cliente?
                </label>
              </div>
              <div id="Cc1" style="display: block">
                <div class="form-group">
                  <label for="iCC1nombre">Nombre completo:</label>
                  <input id="iCC1nombre" class="form-control m-1" type="text" name="NombreCompletoCC1" value="@eOS.NombreCompletoCC1" maxlength="100" />
                </div>
                <div class="form-group">
                  <label for="iCC1email">Correo electrónico:</label>
                  <input id="iCC1email" class="form-control m-1" type="email" name="EmailCC1" value="@eOS.EmailCC1">
                </div>
              </div>
              }
              else
              {
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="ccCheck1">
                <label class="form-check-label m-1" for="ccCheck1">
                  ¿Enviar copia de la notificación al cliente?
                </label>
              </div>
              <div id="Cc1" style="display: none">
                <div class="form-group">
                  <label for="iCC1nombre">Nombre completo:</label>
                  <input id="iCC1nombre" class="form-control m-1" type="text" name="NombreCompletoCC1" maxlength="100" />
                </div>
                <div class="form-group">
                  <label for="iCC1email">Correo electrónico:</label>
                  <input id="iCC1email" class="form-control m-1" type="email" name="EmailCC1">
                </div>
              </div>
              }

              @if (!(String.IsNullOrEmpty(eOS.NombreCompletoCC2) && String.IsNullOrEmpty(eOS.EmailCC2)))
              {
              <div class="form-check" id="ccCheck2" style="display: block">
                <input class="form-check-input" type="checkbox" value="" id="ccCheck2" checked>
                <label class="form-check-label" for="ccCheck2">
                  ¿Otra persona?
                </label>
              </div>
              <div id="Cc2" style="display: block">
                <div class="form-group">
                  <label for="iCC2nombre">Nombre completo:</label>
                  <input id="iCC2nombre" class="form-control m-1" type="text" name="NombreCompletoCC2" value="@eOS.NombreCompletoCC2" maxlength="100" />
                </div>
                <div class="form-group">
                  <label for="iCC2email">Correo electrónico:</label>
                  <input id="iCC2email" class="form-control m-1" type="email" name="EmailCC2" value="@eOS.EmailCC2">
                </div>
              </div>
              }
              else
              {
              <div class="form-check" id="ccCheck2" style="display: none">
                <input class="form-check-input" type="checkbox" value="" id="ccCheck2">
                <label class="form-check-label" for="ccCheck2">
                  ¿Otra persona?
                </label>
              </div>
              <div id="Cc2" style="display: none">
                <div class="form-group">
                  <label for="iCC2nombre">Nombre completo:</label>
                  <input id="iCC2nombre" class="form-control m-1" type="text" name="NombreCompletoCC2" maxlength="100" />
                </div>
                <div class="form-group">
                  <label for="iCC2email">Correo electrónico:</label>
                  <input id="iCC2email" class="form-control m-1" type="email" name="EmailCC2">
                </div>
              </div>
              }

              <div class="form-group">
                <label for="iOp1">Opcional</label>
                <input id="iOp1" type="text" class="form-control" name="Opcional1" value="@eOS.Opcional1" maxlength="100" />
              </div>

              <div class="form-group">
                <label for="iOp4">Opcional</label>
                <input id="iOp4" type="text" class="form-control" name="Opcional4" value="@eOS.Opcional4" maxlength="100" />
              </div>

              <div c1lass="form-group">
                <label for="iOp2">OS Relacionada</label>
                <input id="iOp2" type="text" class="form-control" name="Opcional2" value="@eOS.Opcional2" maxlength="100" />
              </div>

              <div class="form-group">
                <label for="iOp3">Horario de servicio</label>
                <div class="input-group date" id="iOp3" data-target-input="nearest">
                  <input type="text" class="form-control datetimepicker-input" data-target="#iOp3" name="Opcional3" value="@(!String.IsNullOrEmpty(eOS.Opcional3) ? eOS.Opcional3 : null)" placeholder="dd/mm/aaaa 00:00" required/>
                  <div class="input-group-append" data-target="#iOp3" data-toggle="datetimepicker">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                  </div>
                </div>
                <div id="eiOp3"></div>
              </div>

            </div>

            <div id="infoPersonal" class="tab-pane fade show form-section" role="tabpanel">
              <div class="row">
                <div class="col">
                  <h4 class="text-uppercase">Personal Asignado</h4>
                  <table id="tPersonal" data-toggle="table" data-search="true" data-show-columns="false" data-pagination="true" data-locale="es-MX" data-classes="table table-hover" data-page-size="5" data-show-footer="true">
                    <thead class="thead-dark">
                      <tr>
                        <th data-field="id" data-visible="false">ID</th>
                        <th data-field="idpersona" data-visible="false">IdPersona</th>
                        <th data-field="idordper" data-visible="false">IdOrdPer</th>
                        <th data-field="nombre">Nombre</th>
                        <th data-field="puesto">Puesto</th>
                        <th data-field="actions"></th>
                      </tr>
                    </thead>
                    <tbody>
                      @{ int i = 1; }
                      @foreach (var persona in eOS.Personal as List<OrdenPersona>)
                      {
                      if (persona.Estatus)
                      {
                      <tr>
                        <td>@i</td>
                        <td>@persona.Persona.Id</td>
                        <td>@persona.Id</td>
                        <td>@persona.Persona.Nombre @persona.Persona.Paterno @persona.Persona.Materno</td>
                        <td>@persona.Persona.Categoria</td>
                        <td id="inputPersonal">
                          <button id="idx_@i" type="button" class="btn btn-danger float_Table">
                            <i class="fas fa-trash"></i>
                          </button>
                          <input type="hidden" name="Personal[@(i-1)].Id" value="@persona.Id">
                          <input type="hidden" name="Personal[@(i-1)].PersonaId" value="@persona.Persona.Id">
                        </td>
                      </tr>
                      i++;
                      osTotal++;
                      }
                      }
                    </tbody>
                  </table>
                  <br />
                  <div class="form-group row">
                    <label for="osTotal" class="col-sm-2 col-form-label"><b>Total:</b></label>
                    <div class="col-sm-10">
                      <input id="osTotal" type="number" class="form-control-plaintext" readonly value="@osTotal">
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="alert alert-warning alert-dismissible fade show invisible" role="alert">
                    <div id="aPCont"></div>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>

                  <div class="form-group">
                    <label for="osPersonal">Personal registrado</label>
                    <select id="osPersonal" class="form-control">
                      <option value="0"> -- Selecciona una opci&oacute;n -- </option>
                    </select>
                  </div>
                  <div class="row">
                    <div class="col-md-6 offset-md-4 col-lg-6 offset-lg-6 text-right">
                      <button id="btnAddPersonal" class="btn btn-primary" type=button>Asignar personal</button>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div id="infoActivosFijos" class="tab-pane fade show form-section" role="tabpanel">
              <div class="row">
                <div class="col">
                  <h4 class="text-uppercase">Activo Fijo/Producto</h4>
                  <table id="tActivoFijo" data-toggle="table" data-search="true" data-show-columns="false" data-pagination="true" data-locale="es-MX" data-classes="table table-hover" data-page-size="5" data-show-footer="true">
                    <thead class="thead-dark">
                      <tr>
                        <th data-field="idaf" data-visible="false">ID</th>
                        <th data-field="idactivofijo" data-visible="false">IdActivoFijo</th>
                        <th data-field="idordact" data-visible="false">IdOrdAct</th>
                        <th data-field="activo">Nombre</th>
                        <th data-field="tipo">No. Serie</th>
                        <th data-field="opcional2" data-visible="false">No. Producto</th>
                        @if(eOS.LineaNegocio.Nombre.Equals("GARANTÍA")){
                        <th data-field="os">Orden Servicio</th>
                        }
                        <th data-field="actions"></th>
                      </tr>
                    </thead>
                    <tbody>
                      @{ i = 1; }
                      @foreach (var activo in eOS.Activos as List<OrdenActivoFijo>)
                      {
                      if (activo.Estatus)
                      {
                      <tr>
                        <td>@i</td>
                        <td>@activo.ActivoFijo.Id</td>
                        <td>@activo.Id</td>
                        <td>@activo.ActivoFijo.Descripcion</td>
                        <td>@activo.ActivoFijo.Tipo</td>
                        <td>@activo.ActivoFijo.Opcional2</td>
                        @if(eOS.LineaNegocio.Nombre.Equals("GARANTÍA")){
                        <td>(@eOS.Folio)</td>
                        }
                        <td>
                          <button id="idx_@i" type="button" class="btn btn-danger float_Table">
                           <i class="fas fa-trash"></i>
                          </button>
                          <input type="hidden" name="ActivosFijos[@(i-1)].Id" value="@activo.Id">
                          <input type="hidden" name="ActivosFijos[@(i-1)].ActivoFijoId" value="@activo.ActivoFijo.Id">
                        </td>
                      </tr>
                      i++;
                      osafTotal++;
                      }
                      }
                    </tbody>
                  </table>
                  <br />
                  <div class="form-group row">
                    <label for="osafTotal" class="col-sm-2 col-form-label"><b>Total:</b></label>
                    <div class="col-sm-10">
                      <input id="osafTotal" type="number" class="form-control-plaintext" readonly value="@osafTotal">
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="alert alert-warning alert-dismissible fade show invisible" role="alert">
                    <div id="aAFCont"></div>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>

                  <div class="form-group">
                    <label for="osActivoFijo">Activo fijo/Producto registrado  -  No. Serie  /  No. Producto</label>
                    <select id="osActivoFijo" class="form-control">
                      <option value="0"> -- Selecciona una opci&oacute;n -- </option>
                    </select>
                  </div>
                  <div class="row">
                    <div class="col-md-6 offset-md-4 col-lg-6 offset-lg-6 text-right">
                      <button id="btnActivoFijo" class="btn btn-primary" type=button>Asignar activo fijo/producto</button>
                    </div>
                  </div>
                </div>
              </div>

            </div>


            <div id="infoInsumosP" class="tab-pane fade show form-section" role="tabpanel">
              <div class="row">
                <div class="col">
                  <h4 class="text-uppercase">Insumos Utilizados</h4>
                  <table id="tInsumos" data-classes="table table-hover" data-toggle="table" data-search="true" data-show-columns="false" data-locale="es-MX" data-unique-id="idi" data-pagination="true" data-page-size="5" data-show-footer="true">
                    <thead class="thead-dark">
                      <tr>
                        <th data-field="idi" data-visible="false">ID</th>
                        <th data-field="idinsumo" data-visible="false">IdInsumo</th>
                        @*<th data-field="idlote" data-visible="false">IdLote</th>*@
                        @*<th data-field="idpaquete" data-visible="false">IdPaquete</th>*@
                        <th data-field="idordins" data-visible="false">IdOrdIns</th>
                        @*<th data-field="paquete">Paquete</th>*@
                        <th data-field="codigo">Código</th>
                        <th data-field="insumo">Insumo</th>
                        <th data-field="lote">Lote</th>
                        <th data-field="cantidad">Cantidad</th>
                        @*<th data-field="caducidad">Caducidad</th>*@
                        <th data-field="actions"></th>
                      </tr>
                    </thead>
                    <tbody>
                      @{ i = 1; }
                      @foreach (var insumo in eOS.Insumos as List<OrdenInsumo>)
                      {
                      if (insumo.Estatus)
                      {
                      <tr>
                        <td>@i</td>
                        <td>@insumo.Insumo.Id</td>
                        @*<td>@insumo.Lote.Id</td>*@
                        @*<td>@insumo.Paquete.Id</td>*@
                        <td>@insumo.Id</td>
                        @*<td>@insumo.Paquete.Clasificacion</td>*@
                        <td>@insumo.Insumo.Clave</td>
                        <td>@insumo.Insumo.Descripcion</td>
                        <td>@insumo.Lote</td>
                        <td>@insumo.Cantidad</td>
                        @*<td>@insumo.Caducidad</td>*@
                        <td>
                          <button id="idx_@i" type="button" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash" width="10" height="10"></i>
                          </button>
                          <button id="Edit_@i" type="button" class="btn btn-success btn-sm">
                            <i class="fas fa-edit" width="10" height="10"></i>
                          </button>    
                          <input type="hidden" name="Insumos[@(i-1)].Id" value="@insumo.Id">
                          <input type="hidden" name="Insumos[@(i-1)].InsumoId" value="@insumo.Insumo.Id">
                          <input type="hidden" name="Insumos[@(i-1)].Cantidad" value="@insumo.Cantidad">
                        </td>
                      </tr>
                      i++;
                      osiTotal++;
                      }
                      }
                    </tbody>
                  </table>
                  <br />
                  <div class="form-group row">
                    <label for="osiTotal" class="col-sm-2 col-form-label">Total</label>
                    <div class="col-sm-10">
                      <input id="osiTotal" type="number" class="form-control-plaintext" readonly value="@osiTotal">
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="alert alert-warning alert-dismissible fade show invisible" role="alert">
                    <div id="aICont"></div>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>

                  <div class="form-group">
                    <label for="osPaquete">Paquete</label>
                    <select id="osPaquete" class="form-control">
                      <option value=""> -- Selecciona una opci&oacute;n -- </option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="osInsumoSearch" style="display: none">Búsqueda de insumo</label>
                    <input id="osInsumoSearch" class="form-control" type="text" disabled style="display: none">
                  </div>

                  <div class="form-group">
                    <label for="osInsumo">Insumo</label>
                    <div class="form-inline">
                      <div class="col-6">
                    <select id="osInsumo" class="form-control selectpicker" data-live-search="true" multiple data-selected-text-format="count" data-width="auto" data-show-content="true" data-size="10" data-window-padding="20">
                      @*<select id="osInsumo" class="form-control">
                        <option value=""> -- Selecciona una opci&oacute;n -- </option>*@
                      </select>
                      </div>
                      <div class="col-12 col-lg-6">
                        <button id="addInsumo" class="form-control btn btn-primary" type="button">Capturar datos por insumo</button>
                      </div>
                    </div>
                  </div>
                  @*<div class="form-group">
                    <label for="osLote">Lote</label>
                    <select id="osLote" class="form-control">
                      <option value=""> -- Selecciona una opci&oacute;n -- </option>
                    </select>
                  </div>
                  <div class="form-group">
                    <small id="osLoteCaducidad"></small>
                    <small id="osLoteAsignado"></small>
                    <small id="osLoteTeorico"></small>
                    <small id="osLoteFisico"></small>
                  </div>*@
                  @*<div class="form-group">
                    <label for="osLoteI">Lote</label>
                    <input id="osLoteI" type="text" class="form-control">
                  </div>
                  <div class="form-group">
                    <label for="osCaducidad">Caducidad</label>
                    <input id="osCaducidad" type="text" class="form-control" placeholder="dd/MM/aaaa">
                  </div>
                  <div class="form-group">
                    <label for="osCantidad">Cantidad</label>
                    <input id="osCantidad" type="number" min="1" class="form-control">
                  </div>*@
                  <div class="row">
                    <div class="col-md-6 offset-md-4 col-lg-6 offset-lg-6">
                      @*<button id="btnAddInsumo" class="btn btn-primary" type=button>Asignar insumo</button>*@
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div id="infoInsumos" class="tab-pane fade show form-section" role="tabpanel">
              <div class="row">
                <div class="col">
                  <h4 class="text-uppercase">Insumos Utilizados</h4>
                  <table id="t_Insumos" data-toggle="table" data-search="true" data-show-columns="false" data-pagination="true" data-locale="es-MX" data-classes="table table-hover" data-page-size="5" data-show-footer="true">
                    <thead class="thead-dark">
                      <tr>
                        <th data-field="idi" data-visible="false">ID</th>
                        <th data-field="idinsumo" data-visible="false">IdInsumo</th>
                        <th data-field="idordins" data-visible="false">IdOrdIns</th>
                        <th data-field="insumo">Insumo</th>
                        <th data-field="cantidad">Cantidad</th>
                        <th data-field="actions"></th>
                      </tr>
                    </thead>
                    <tbody>
                      @{ i = 1; }
                      @foreach (var insumo in eOS.Insumos as List<OrdenInsumo>)
                      {
                      if (insumo.Estatus)
                      {
                      <tr>
                        <td>@i</td>
                        <td>@insumo.Insumo.Id</td>
                        <td>@insumo.Id</td>
                        <td>@insumo.Insumo.Descripcion</td>
                        <td>@insumo.Cantidad</td>
                        <td>
                          <button id="idx_@i" type="button" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash"></i>
                          </button>
                          <button id="Edit_@i" type="button" class="btn btn-success btn-sm">
                            <i class="fas fa-edit"></i>
                          </button>
                          <input type="hidden" name="Insumos[@(i-1)].Id" value="@insumo.Id">
                          <input type="hidden" name="Insumos[@(i-1)].InsumoId" value="@insumo.Insumo.Id">
                          <input type="hidden" name="Insumos[@(i-1)].Cantidad" value="@insumo.Cantidad">
                        </td>
                      </tr>
                      i++;
                      osiTotal++;
                      }
                      }
                    </tbody>
                  </table>
                  <br />
                  <div class="form-group row">
                    <label for="osiTotal" class="col-sm-2 col-form-label"><b>Total:</b></label>
                    <div class="col-sm-10">
                      <input id="osiTotal" type="number" class="form-control-plaintext" readonly value="@osiTotal">
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="alert alert-warning alert-dismissible fade show invisible" role="alert">
                    <div id="aICont"></div>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>

                  <div class="form-group">
                    <label for="os_Insumo">Insumo</label>
                    <select id="os_Insumo" class="form-control">
                      <option value="0"> -- Selecciona una opci&oacute;n -- </option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="osCantidad">Cantidad</label>
                    <input id="osCantidad" type="number" min="0" class="form-control">
                  </div>
                  <div class="row">
                    <div class="col-md-6 offset-md-4 col-lg-6 offset-lg-6 text-right">
                      <button id="btnAddInsumo" class="btn btn-primary" type=button>Asignar insumo</button>
                    </div>
                  </div>
                </div>
                
              </div>
            </div>

            <input type="hidden" name="Estatus" value="@(eOS.Estatus ? "true" : "false" )" />
            <input type="hidden" name="Id" value="@eOS.Id" />
            <input type="hidden" name="dtPersonas" value="" />
            <input type="hidden" name="dtActivos" value="" />
            <input type="hidden" name="dtInsumos" value="" />

          </div>
              <div class="form-row margTop40">
                    <div class="col"></div>
                    <div class="col">
                      <button id="btnSave" class="btn btn-success btn-block">Guardar &Oacute;rden de Servicio</button>
                    </div>
                    <div class="col"></div>
                </div>
        </div>
      </div>
    </form>
  </div>
</div>
    </div>
  </div>
</div>

<div class="modal fade" id="fechaFinMenorFechaInicio" tabindex="-1" role="dialog" aria-labelledby="fechaFinMenorFechaInicioLabel" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content alert alert-light">
      <div class="modal-header">
        <h5 class="modal-title" id="fechaFinMenorFechaInicioLabel">Advertencia</h5>
      </div>
      <div class="modal-body"><p align="center">Ha ingresado una fecha inválida. La <b>Fecha/Hora fin</b> es menor a la <b>Fecha/Hora inicio</b>.</p><p align="center">Favor de volver a capturar la <b>Fecha/Hora fin</b></p></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

@section scripts {
<script>

  console.log(@Html.Raw(Json.Serialize(ViewData["esCancelable"])));

  //var eosFechaInicio = '@(eOS.FechaInicio.HasValue ? ((DateTime) eOS.FechaInicio).ToString("d", CultureInfo.CreateSpecificCulture("es-ES")) : "")';
  //var eosFechaFin = '@(eOS.FechaFin.HasValue ? ((DateTime) eOS.FechaFin).ToString("d", CultureInfo.CreateSpecificCulture("es-ES")) : "")';
  const paqueteP = @Html.Raw(Json.Serialize(paquete));
  let contacts = [];
  $(document).ready( function () {

    const slcContactos = (() => {
      $.ajax({
        url: '@Url.Action("GetContactoCliente","Rest")',
        method: "GET",
        data: {
          cId: @eOS.Cliente.Id
        },
        async: true,
        dataType: "json",
        success: data => {
          if(data.success){
            contacts.length = 0;
            contacts = [...data.data ];
            $("#slcContacto").empty().append(`<option value="null" selected disabled>Selecciona un Contacto</option>`);
            for (const contacto of data.data) {
              $("#slcContacto").append(`<option value="${contacto.id}">${contacto.nombre} ${contacto.paterno} ${contacto.materno}</option>`);      
            }
          }
        }
      });
    })();

    $('#iFechaInicio').datetimepicker({
      locale: 'es',
      focusOnShow: false,
      inline: true,
      sideBySide: true
    });

    $('#iFechaFin').datetimepicker({
      locale: 'es',
      focusOnShow: false,
      inline: true,
      sideBySide: true
    });

    $('#iOp3').datetimepicker({
      locale: 'es',
      focusOnShow: false,
      inline: true,
      sideBySide: true
    });
  });

  $("#iCliente").change(() => {
    $.ajax({
      url: '@Url.Action("GetContactoCliente","Rest")',
      method: "GET",
      data: {
        cId: $("#iCliente").val()
      },
      async: true,
      dataType: "json",
      success: data => {
        if(data.success){
          contacts.length = 0;
          contacts = [...data.data ];
          $("#slcContacto").empty().append(`<option value="null" selected disabled>Selecciona un Contacto</option>`);
          for (const contacto of data.data) {
            $("#slcContacto").append(`<option value="${contacto.id}">${contacto.nombre} ${contacto.paterno} ${contacto.materno}</option>`);      
          }
          $("#iNombre").val("");
          $("#iAp").val("");
          $("#iAm").val("");
          $("#iEm").val("");
          $("#iTel").val("");
        }
      }
    });
  });

  $("#slcContacto").change(()=>{
    const result = contacts.filter(contact => contact.id == $("#slcContacto").val());
    $("#iNombre").val(result[0].nombre);
    $("#iAp").val(result[0].paterno);
    $("#iAm").val(result[0].materno);
    $("#iEm").val(result[0].email);
    $("#iTel").val(result[0].telefono);
  });  


document.getElementById("osCantidad").addEventListener("keypress", function (evt) {
    if (evt.which != 8 && evt.which != 0 && evt.which < 48 || evt.which > 57 ){
        evt.preventDefault();
    }
});
document.getElementById("iTel").addEventListener("keypress", function (evt) {
    if (evt.which != 8 && evt.which != 0 && evt.which < 48 || evt.which > 57 ){
        evt.preventDefault();
    }
});
</script>
<script src="~/lib/Parsley-2.8.1/parsley.min.js"></script>
<script src="~/lib/Parsley-2.8.1/i18n/es.js"></script>
<script src="~/js/moment-2.22.2/min/moment-with-locales.js"></script>
<script src="~/lib/tempusdominus-5.0.0/build/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="~/lib/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
<script src="~/js/editOrdenServicio.js"></script>
}
