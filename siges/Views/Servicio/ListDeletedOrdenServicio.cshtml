@using siges.Models
@{
    ViewData["Title"] = "Órdenes de Servicio Eliminadas";
}

@section css{
    <link href="~/lib/bootstrap-table-1.12.1/dist/extensions/filter-control/bootstrap-table-filter-control.min.css" rel="stylesheet" />
    <link href="~/lib/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet" />
}
@Html.AntiForgeryToken()

<div class="container">
    <div class="row">
        <div class="col">
            <h2>&Oacute;rdenes de Servicio Eliminadas</h2>
        </div>
        <div class="col align-self-center text-right">
            <a class="btn bg-blue marg-Float float" href='@Url.Action("IndexListOS", "Servicio")' data-toggle="tooltip" data-placement="bottom" title="Regresar" data-original-title="Tooltip on bottom"><i class="fas fa-arrow-left"></i></a>
        </div>
    </div>
    <div class="row">
        <div class="col margBott4em">
            <table id="tOrdenes" data-search="true" data-toggle="table" data-show-columns="false" data-pagination="true" data-locale="es-MX" data-classes="table table-hover" data-page-size="5"  data-page-list="[5,10,25]" data-show-footer="true" data-filter-control="true" data-filter-show="true" data-sort-name="folio" data-show-search-clear-button="true" >
                <thead>
                    <tr>
                        <th data-field="id" data-visible="false"></th>
                        <th data-field="folio" data-sortable="true">Folio</th>
                        <th  data-field="fecha" data-sortable="true" data-sorter="dateSort" data-filter-control="input">Fecha</th>
                        <th  data-field="cliente" data-sortable="true" data-filter-control="select">Cliente</th>
                        <th  data-field="documento" data-sortable="true" data-filter-control="select">Contrato</th>
                        <th  data-field="ubicacion" data-sortable="true" data-filter-control="select">Ubicaci&oacute;n</th>
                        <th  data-field="servicio" data-sortable="true" data-filter-control="select">Servicio</th>
                        <th  data-field="estatus" data-sortable="true" data-filter-control="select">Estatus</th>
                        <th class="mobileHidden">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var orden in ViewData["ordenes"] as List<OrdenServicio>){
                        <tr>
                            <td>@orden.Id</td>
                            <td>@orden.Folio</td>
                            <td>@(orden.FechaInicio.HasValue ? orden.FechaInicio.Value.Date.ToString("dd/MM/yyyy") : "Sin fecha registrada" )</td>
                            <td>@orden.Cliente.RazonSocial</td>
                            <td>@orden.Contrato.Nombre</td>
                            <td>@orden.Ubicacion.Nombre</td>
                            <td>@orden.Servicio.Nombre</td>
                            <td>@orden.EstatusServicio</td>
                            <td class="mobileHidden">
                                <a class="btn btn-success float_Table" data-toggle="tooltip" data-placement="bottom" title="Restaurar" data-original-title="Tooltip on bottom"><i class="fas fa-reply"></i></a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section scripts{
<script src="~/lib/bootstrap-table-1.12.1/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
<script src="~/lib/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
<script>
    $('#tOrdenes').on('click-row.bs.table', (row, element, field) => {
        const token = $("[name='__RequestVerificationToken']").val();
        Swal.fire({
            icon: 'question',
            title: `La órden de servicio ${element.folio} se restaurará`,
            text: `¿Seguro qué deseas restaurarla?`,
            reverseButtons: true,
            showCancelButton: true,
            confirmButtonText:"Si, Restaurar",
            cancelButtonText:"No, Cancelar",
            confirmButtonColor:"#67E7CF",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCloseButton: true,
            closeButtonHtml: '<i class="fas fa-times"></i>'
        }).then(result => {
            if(result.value){
                $.ajax({
                    url: '@Url.Action("UpdateDOS","Servicio")',
                    method: "POST",
                    data: {
                        __RequestVerificationToken: token,
                        osid: parseInt(element.id)
                    },
                    async: true,
                    dataType: "json",
                    success: function (res){
                        if(res.success){
                            Swal.fire({
                                icon: 'success',
                                title: '¡Éxito!',
                                confirmButtonColor: "#67E7CF",
                                confirmButtonText:"Aceptar",
                                text: `La persona órden de servicio se restauró`,
                                onClose: ()=>{
                                    location.reload(true);
                                }
                            }).then(result => {
                                if (result.value) {
                                    location.reload(true);
                                }
                            });
                        }
                    }
                });
            }
            else{
                Swal.close();
            }
        });
    });
</script>
}