@model IEnumerable<siges.Models.Persona>

@{
    ViewData["Title"] = "Personas Eliminadas";
    List<siges.Models.Persona> personas = ViewData["persona"] as List<siges.Models.Persona>;
}

<div class="container">
    <div class="row">
        <div class="col">
            <h2>Personas Eliminadas</h2>
        </div>
            <div class="col align-self-center text-right">
                <a class="btn bg-blue marg-Float float" href='@Url.Action("Index", "Personas")' data-toggle="tooltip" data-placement="bottom" title="Regresar" data-original-title="Tooltip on bottom"><i class="fas fa-arrow-left"></i></a>
            </div>
    </div>
    <div class="row">
        <div class="col margBott4em">
                <table id="tableIndexClientes" data-toggle="table" data-search="true" data-show-columns="false" data-pagination="true" data-locale="es-MX" data-classes="table table-hover" data-page-size="5"  data-page-list="[5,10,25]" data-show-footer="true" data-sort-name="name">
                <thead>
                    <tr>
                        <th data-visible="false" data-field="id"></th>
                        <th>Fotografía</th>
                        <th data-sortable="true" data-field="name">@Html.DisplayNameFor(model => model.Nombre)</th>
                        <th data-sortable="true">Correo Electrónico</th>
                        <th data-sortable="true">@Html.DisplayNameFor(model => model.RFC)</th>
                        <th data-sortable="true">@Html.DisplayNameFor(model => model.Puesto)</th>
                        <th class="mobileHidden">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in personas) {
                        var nombre = item.Nombre +" "+ item.Paterno + " " + item.Materno;
                        var imgSrc = Url.Content("~/img/staff_ad.png");
                        if(item.Fotografia != null){
                        var base64 = Convert.ToBase64String(item.Fotografia);
                        imgSrc = String.Format("data:image/jpeg;base64,{0}",base64);
                        }
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.Id)</td>
                            @* <td><img src="~/img/staff_ad.png" alt="Alternate Text" width="50" height="50" /></td> *@
                            <td><img src="@imgSrc" class="text-hide rounded" width="50" height="50" alt="@nombre"></td>
                            <td>@Html.DisplayFor(modelItem => nombre)</td>
                            <td>@Html.DisplayFor(modelItem => item.Email)</td>
                            <td>@Html.DisplayFor(modelItem => item.RFC)</td>
                            <td>@Html.DisplayFor(modelItem => item.Puesto)</td>
                            <td class="mobileHidden">
                                <a class="btn btn-success float_Table" data-toggle="tooltip" data-placement="bottom" title="Restaurar" data-original-title="Tooltip on bottom"><i class="fas fa-user-check"></i></a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section scripts{
<script>
    $('#tableIndexClientes').on('click-row.bs.table', (row, element, field) => {
        Swal.fire({
            icon: 'question',
            title: `${element.name} se restaurará`,
            text: `¿Seguro que deseas restaurarla?`,
            reverseButtons: true,
            showCancelButton: true,
            confirmButtonText:"Si, Restaurar",
            cancelButtonText:"No, Cancelar",
            confirmButtonColor:"#67E7CF",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCloseButton: true,
            closeButtonHtml: '<i class="fas fa-times"></i>'
        }).then(result => {
            if(result.value){
                $.ajax({
                    url: '@Url.Action("UpdateDP","Personas")',
                    method: "POST",
                    data: {
                        pid: element.id
                    },
                    async: true,
                    dataType: "json",
                    success: function (res){
                        if(res.success){
                            Swal.fire({
                                icon: 'success',
                                title: '¡Éxito!',
                                confirmButtonColor: "#67E7CF",
                                confirmButtonText:"Aceptar",
                                text: `La persona ${element.name} se restauró`,
                                onClose: ()=>{
                                    location.reload(true);
                                }
                            }).then(result => {
                                if (result.value) {
                                    location.reload(true);
                                }
                            });
                        }
                    }
                });
            }
            else{
                Swal.close();
            }
        });
    });
</script>
}